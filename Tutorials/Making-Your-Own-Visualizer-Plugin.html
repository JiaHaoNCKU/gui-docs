
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Making Your Own Visualizer Plugin &#8212; Open Ephys GUI Docs</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FAQs" href="../FAQ/index.html" />
    <link rel="prev" title="How To Make Your Own Plugin" href="How-To-Make-Your-Own-Plugin.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="light">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/oe_logo_gui.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/oe_logo_gui.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../User-Manual/index.html">
                        User Manual
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../Developer-Guide/index.html">
                        Developer Guide
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Tutorials
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../FAQ/index.html">
                        FAQs
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/open-ephys" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../User-Manual/index.html">
                        User Manual
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../Developer-Guide/index.html">
                        Developer Guide
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Tutorials
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../FAQ/index.html">
                        FAQs
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/open-ephys" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Closed-Loop-Latency.html">Measuring Closed-Loop Latency</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data-Synchronization.html">Synchronizing Data Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-To-Make-Your-Own-Plugin.html">How To Make Your Own Plugin</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Making Your Own Visualizer Plugin</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="making-your-own-visualizer-plugin">
<span id="makingyourownvisualizerplugin"></span><h1>Making Your Own Visualizer Plugin<a class="headerlink" href="#making-your-own-visualizer-plugin" title="Permalink to this heading">#</a></h1>
<p>All processor plugins within the Open Ephys GUI have the option of creating a “Visualizer” that appears as a tab in the Viewport or in a separate window. Visualizers can be used to hold parameter-setting interfaces that are too bit to fit inside the plugin’s editor, or they can display real-time animations of the data being handled by the plugin.</p>
<p>This tutorial will guide you through the steps involved in making a Visualizer plugin from scratch. At the end, you will have created a “Rate Viewer” plugin that displays the rate at which spikes are occurring on an upstream electrode. Along with explaining how to configure the plugin and set up the main <code class="code docutils literal notranslate"><span class="pre">process()</span></code> method, this tutorial will demonstrate how to create a real-time data display using the GUI’s built-in Interactive Plot class.</p>
<p>If you get stuck, you can take a look at the finished plugin source code here to see if your version matches: <a class="github reference external" href="https://github.com/open-ephys-plugins/rate-viewer">open-ephys-plugins/rate-viewer</a></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>These instructions assume you have already compiled the main application from source. If not, you should start by following the instructions on <a class="reference internal" href="../Developer-Guide/Compiling-the-GUI.html#compilingthegui"><span class="std std-ref">this page</span></a>.</p>
</div>
<section id="creating-a-new-plugin-repository">
<h2>Creating a new plugin repository<a class="headerlink" href="#creating-a-new-plugin-repository" title="Permalink to this heading">#</a></h2>
<p>The first step in creating a plugin is to create a new code repository from a template. There are five different types of plugins that include pre-defined templates: <strong>Processor Plugins</strong>, <strong>Visualizer Plugins</strong>, <strong>Data Threads</strong>, <strong>Record Engines</strong>, and <strong>File Sources</strong>. Since in this case we are creating a plugin with a built-in Visualizer, we will use the <strong>Visualizer Plugin</strong> template:</p>
<ol class="arabic simple">
<li><p>Log in to your <a class="reference external" href="https://github.com/">GitHub</a> account.</p></li>
<li><p>Browse to the <a class="reference external" href="https://github.com/open-ephys-plugins/visualizer-plugin-template">Visualizer Plugin Template</a> repository.</p></li>
<li><p>Click the green “Use this template” button and select the “Create a new repository” option.</p></li>
</ol>
<img alt="Visualizer Plugin Template Repository" src="../_images/visualizerplugin-01.png" />
<ol class="arabic simple" start="4">
<li><p>Name the repository “rate-viewer”, since this plugin will be used to visualize the spike rate of an electrode.</p></li>
<li><p>Set the Description to “Open Ephys GUI visualizer tutorial”.</p></li>
<li><p>Click the green “Create repository from template” button.</p></li>
</ol>
<img alt="Create rate-viewer Repository" src="../_images/visualizerplugin-02.png" />
<p>On your local machine, create an “OEPlugins” directory within the same directory that contains your <code class="code docutils literal notranslate"><span class="pre">plugin-GUI</span></code> repository. Then, using the <a class="reference external" href="https://git-scm.com/">git</a> command-line interface or the <a class="reference external" href="https://desktop.github.com/">GitHub Desktop</a> app, clone the newly created plugin repository into this directory.</p>
<p>Your directory structure should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">code_directory</span><span class="o">/</span>
   <span class="n">plugin</span><span class="o">-</span><span class="n">GUI</span><span class="o">/</span>
   <span class="n">OEPlugins</span><span class="o">/</span>
      <span class="n">rate</span><span class="o">-</span><span class="n">viewer</span><span class="o">/</span>
         <span class="n">Build</span><span class="o">/</span>
         <span class="n">Resources</span><span class="o">/</span>
         <span class="n">Source</span><span class="o">/</span>
         <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
         <span class="n">CMAKE_README</span><span class="o">.</span><span class="n">txt</span>
         <span class="n">README</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
</section>
<section id="editing-openephyslib-cpp-and-other-files">
<h2>Editing <code class="code docutils literal notranslate"><span class="pre">OpenEphysLib.cpp</span></code> and other files<a class="headerlink" href="#editing-openephyslib-cpp-and-other-files" title="Permalink to this heading">#</a></h2>
<p>Inside the “Source” directory, you’ll find the <code class="file docutils literal notranslate"><span class="pre">OpenEphysLib.cpp</span></code> file that contains critical information about your plugin. Open it in your preferred text editor and make the following changes:</p>
<ol class="arabic simple">
<li><p>Change the library <code class="code docutils literal notranslate"><span class="pre">info-&gt;name</span></code> on line 46 from <code class="code docutils literal notranslate"><span class="pre">VisualizerPlugin</span></code> to <code class="code docutils literal notranslate"><span class="pre">Rate</span> <span class="pre">Viewer</span></code></p></li>
<li><p>Change <code class="code docutils literal notranslate"><span class="pre">info-&gt;processor.name</span></code> on line 62 to from <code class="code docutils literal notranslate"><span class="pre">VisualizerPlugin</span></code> to <code class="code docutils literal notranslate"><span class="pre">Rate</span> <span class="pre">Viewer</span></code></p></li>
<li><p>Change <code class="code docutils literal notranslate"><span class="pre">info-&gt;processor.creator</span></code> to <code class="code docutils literal notranslate"><span class="pre">&amp;(Plugin::createProcessor&lt;RateViewer&gt;);</span></code></p></li>
</ol>
<p>When you’re finished, the file should look like this:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">OpenEphysLib.cpp</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">EXPORT</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">getLibInfo</span><span class="p">(</span><span class="n">Plugin</span><span class="o">::</span><span class="n">LibraryInfo</span><span class="o">*</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="cm">/* API version, defined by the GUI source.</span>
<span class="cm">   Should not be changed to ensure it is always equal to the one used in the latest codebase.</span>
<span class="cm">   The GUI refuses to load plugins with mismatched API versions */</span><span class="w"></span>
<span class="w">   </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PLUGIN_API_VER</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Rate Viewer&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Name of the plugin library &lt;---- UPDATE</span>
<span class="w">   </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">libVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.1.0&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//Version of the plugin</span>
<span class="w">   </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">numPlugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NUM_PLUGINS</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">EXPORT</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">getPluginInfo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Plugin</span><span class="o">::</span><span class="n">PluginInfo</span><span class="o">*</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">//one case per plugin. This example is for a processor which connects directly to the signal chain</span>
<span class="w">   </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Type of plugin. See &quot;Source/Processors/PluginManager/OpenEphysPlugin.h&quot; for complete info about the different type structures</span>
<span class="w">      </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Plugin</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">PROCESSOR</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Processor name</span>
<span class="w">      </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">processor</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Rate Viewer&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Processor name shown in the GUI &lt;---- UPDATE</span>

<span class="w">      </span><span class="c1">//Type of processor. Visualizers are usually sinks, but they can also be SOURCE or FILTER processors.</span>
<span class="w">      </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">processor</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Processor</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">SINK</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Class factory pointer. Replace &quot;ProcessorPluginSpace::ProcessorPlugin&quot; with the namespace and class name.</span>
<span class="w">      </span><span class="n">info</span><span class="o">-&gt;</span><span class="n">processor</span><span class="p">.</span><span class="n">creator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">Plugin</span><span class="o">::</span><span class="n">createProcessor</span><span class="o">&lt;</span><span class="n">RateViewer</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;---- UPDATE</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Note that we’ll keep the processor type for the Rate Viewer plugin as a <code class="code docutils literal notranslate"><span class="pre">SINK</span></code> (line 65), since it won’t modify the underlying data at all. However, Visualizer plugins can also be Sources (if they generate data) or Filters (if they modify data).</p>
<p>Next, rename the <code class="code docutils literal notranslate"><span class="pre">VisualizerPlugin.cpp</span></code> &amp; <code class="code docutils literal notranslate"><span class="pre">VisualizerPlugin.h</span></code> files to <code class="code docutils literal notranslate"><span class="pre">RateViewer.cpp</span></code> and <code class="code docutils literal notranslate"><span class="pre">RateViewer.h</span></code>, and find and replace all instances of the <strong>VisualizerPlugin</strong> class name to <strong>RateViewer</strong> in the .cpp and .h files. Do the same with <code class="code docutils literal notranslate"><span class="pre">VisualizerPluginEditor.cpp</span></code>, <code class="code docutils literal notranslate"><span class="pre">VisualizerPluginEditor.h</span></code>, <code class="code docutils literal notranslate"><span class="pre">VisualizerPluginCanvas.cpp</span></code>, and <code class="code docutils literal notranslate"><span class="pre">VisualizerPluginCanvas.h</span></code>.</p>
<p>Next, change the “display name” of the plugin on line 30 of <code class="code docutils literal notranslate"><span class="pre">RateViewer.h</span></code> from <code class="code docutils literal notranslate"><span class="pre">Visualizer</span></code> to <code class="code docutils literal notranslate"><span class="pre">Rate</span> <span class="pre">Viewer</span></code>.</p>
<p>Finally, update the include inside <code class="code docutils literal notranslate"><span class="pre">OpenEphysLib.cpp</span></code> from <code class="code docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;VisualizerPlugin.h&quot;</span></code> to <code class="code docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;RateViewer.h&quot;</span></code>.</p>
</section>
<section id="compiling-your-plugin">
<h2>Compiling your plugin<a class="headerlink" href="#compiling-your-plugin" title="Permalink to this heading">#</a></h2>
<p>At this point, you should be able to compile your plugin and load it into the GUI. We advise you to compile and test the plugin every time you make changes, so that it is easier for you to identify what changes caused crashes, if they happen.</p>
<p>To compile the plugin, please follow the OS-specific instructions described on the <a class="reference internal" href="../Developer-Guide/Compiling-plugins.html#compilingplugins"><span class="std std-ref">compiling plugins</span></a> page.</p>
</section>
<section id="setting-up-the-processor-methods">
<h2>Setting up the Processor methods<a class="headerlink" href="#setting-up-the-processor-methods" title="Permalink to this heading">#</a></h2>
<p>Right now, our plugin won’t do anything with the incoming data when it’s placed in the signal chain. Spikes passed into the <code class="code docutils literal notranslate"><span class="pre">RateViewer::handleSpike()</span></code> method will not be used in any way.</p>
<p>There are a few steps required before we implement this <code class="code docutils literal notranslate"><span class="pre">handleSpike()</span></code> method. The first is to take metadata about available spike channels (also called electrodes) and store it locally. This is necessary as we want the user to have the ability to select which electrode to use for spike rate visualization.</p>
<p>To make sure the most up-to-date information about incoming electrodes is available, we need to update the electrode metadata each time the <code class="code docutils literal notranslate"><span class="pre">updateSettings()</span></code> method is called, which happens whenever the signal chain is modified. Before adding code to the <code class="code docutils literal notranslate"><span class="pre">updateSettings()</span></code> method, we need somewhere to store the electrode information, so we’ll define an “Electrode” <code class="code docutils literal notranslate"><span class="pre">struct</span></code> first.</p>
<p>In the plugin’s <code class="code docutils literal notranslate"><span class="pre">RateViewer.h</span></code> file, add the following lines under the <code class="code docutils literal notranslate"><span class="pre">private</span></code> specifier:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="k">struct</span><span class="w"> </span><span class="nc">Electrode</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="n">uint16</span><span class="w"> </span><span class="n">streamId</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="kt">float</span><span class="w"> </span><span class="n">sampleRate</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// To keep track of which electrode is being visualized</span>
<span class="w">   </span><span class="p">};</span><span class="w"></span>


<span class="w">   </span><span class="n">OwnedArray</span><span class="o">&lt;</span><span class="n">Electrode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">electrodes</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">SpikeChannel</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Electrode</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">electrodeMap</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>This defines a <code class="code docutils literal notranslate"><span class="pre">struct</span></code> to hold relevant information about each upstream electrode, and creates an <code class="code docutils literal notranslate"><span class="pre">OwnedArray</span></code> (from the JUCE library) to store them. In addition, we’ll create a <code class="code docutils literal notranslate"><span class="pre">std::map</span></code> object to make it simple to associate each <code class="code docutils literal notranslate"><span class="pre">SpikeChannel</span></code> pointer (one of the GUI’s built-in classes) with our custom Electrode <code class="code docutils literal notranslate"><span class="pre">structs</span></code>.</p>
<p>Next, inside the <code class="code docutils literal notranslate"><span class="pre">updateSettings()</span></code> method in <code class="code docutils literal notranslate"><span class="pre">RateViewer.cpp</span></code>, we will loop through the available <code class="code docutils literal notranslate"><span class="pre">SpikeChannel</span></code> pointers and store their metadata locally. Before <code class="code docutils literal notranslate"><span class="pre">updateSettings()</span></code> is called, the <code class="code docutils literal notranslate"><span class="pre">spikeChannels</span></code> array will be automatically updated to hold the latest information about upstream spike channel objects.</p>
<p>In the plugin’s <code class="code docutils literal notranslate"><span class="pre">.cpp</span></code> file, add the following lines:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::updateSettings</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">electrodes</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear previous entries first</span>
<span class="w">   </span><span class="n">electrodeMap</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">spikeChan</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">spikeChannels</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">spikeChan</span><span class="o">-&gt;</span><span class="n">isValid</span><span class="p">())</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Electrode</span><span class="o">*</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Electrode</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spikeChan</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">streamId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spikeChan</span><span class="o">-&gt;</span><span class="n">getStreamId</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">sampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spikeChan</span><span class="o">-&gt;</span><span class="n">getSampleRate</span><span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="n">electrodes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">electrode</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">electrodeMap</span><span class="p">[</span><span class="n">spikeChan</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">electrode</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Now, the plugin can hold onto information about the incoming spike channels. Next, we will add UI components to allow the user to select the active electrode and change visualizer parameters.</p>
</section>
<section id="adding-ui-components-to-the-editor">
<h2>Adding UI components to the editor<a class="headerlink" href="#adding-ui-components-to-the-editor" title="Permalink to this heading">#</a></h2>
<p>In order to change the active electrode during runtime, we will use a <code class="code docutils literal notranslate"><span class="pre">ComboBox</span></code> (or drop-down menu) inside the plugin’s editor.</p>
<p>You should have already modified the file and class names for the plugin’s editor; make sure <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor.h</span></code> and <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor.cpp</span></code> files look like this:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.h</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef RATEVIEWEREDITOR_H_DEFINED</span>
<span class="cp">#define RATEVIEWEREDITOR_H_DEFINED</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;VisualizerEditorHeaders.h&gt;</span><span class="cp"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateViewerEditor</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">VisualizerEditor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Constructor */</span><span class="w"></span>
<span class="w">   </span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">GenericProcessor</span><span class="o">*</span><span class="w"> </span><span class="n">parentNode</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Destructor */</span><span class="w"></span>
<span class="w">   </span><span class="o">~</span><span class="n">RateViewerEditor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Creates the canvas */</span><span class="w"></span>
<span class="w">   </span><span class="n">Visualizer</span><span class="o">*</span><span class="w"> </span><span class="n">createNewCanvas</span><span class="p">();</span><span class="w"></span>

<span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Generates an assertion if this class leaks */</span><span class="w"></span>
<span class="w">   </span><span class="n">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</span><span class="p">(</span><span class="n">RateViewerEditor</span><span class="p">);</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="cp">#endif </span><span class="c1">// RateViewerEDITOR_H_DEFINED</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.cpp</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewerEditor.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewerCanvas.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewer.h&quot;</span><span class="cp"></span>


<span class="n">RateViewerEditor</span><span class="o">::</span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">GenericProcessor</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Visualizer&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">//addSelectedChannelsParameterEditor(&quot;Channels&quot;, 20, 105);</span>
<span class="p">}</span><span class="w"></span>

<span class="n">Visualizer</span><span class="o">*</span><span class="w"> </span><span class="n">RateViewerEditor</span><span class="o">::</span><span class="n">createNewCanvas</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RateViewerCanvas</span><span class="p">((</span><span class="n">RateViewerEditor</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">getProcessor</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>We will make a small change to <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor.cpp</span></code>, which is to change the tab text from “Visualizer” to “Spike Rate”, and increase the width of the editor by 10 pixels. After making these changes, the <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code> constructor should look like this”</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor constructor</span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">RateViewerEditor</span><span class="o">::</span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">GenericProcessor</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spike Rate&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">210</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">//addSelectedChannelsParameterEditor(&quot;Channels&quot;, 20, 105);</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<section id="creating-a-combo-box">
<h3>Creating a Combo Box<a class="headerlink" href="#creating-a-combo-box" title="Permalink to this heading">#</a></h3>
<p>To make it possible to change the active electrode, we will create a selectable list of all the available electrodes for the currently selected stream in the editor. Create a <code class="code docutils literal notranslate"><span class="pre">ComboBox`</span></code> in the editor by making the following changes in <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor.h</span></code>:</p>
<ol class="arabic simple">
<li><p>Have the <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code> class inherit from <code class="code docutils literal notranslate"><span class="pre">ComboBox::Listener</span></code>, in addition to <code class="code docutils literal notranslate"><span class="pre">VisualizerEditor</span></code>:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RateViewerEditor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">VisualizerEditor</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="k">public</span><span class="w"> </span><span class="n">ComboBox</span><span class="o">::</span><span class="n">Listener</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Declare the <code class="code docutils literal notranslate"><span class="pre">comboBoxChanged()</span></code> method in the “public” section of <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code>:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** ComboBox::Listener callback*/</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">comboBoxChanged</span><span class="p">(</span><span class="n">ComboBox</span><span class="o">*</span><span class="w"> </span><span class="n">comboBox</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Declare a <code class="code docutils literal notranslate"><span class="pre">ComboBox</span></code> in the “private” section of <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code> using a <code class="code docutils literal notranslate"><span class="pre">std::unique_ptr</span></code>:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ComboBox</span><span class="o">&gt;</span><span class="w"> </span><span class="n">electrodeList</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The declaration of the <code class="code docutils literal notranslate"><span class="pre">RateViewer.h</span></code> class should now look like this:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.h</span><a class="headerlink" href="#id7" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RateViewerEditor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">VisualizerEditor</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="k">public</span><span class="w"> </span><span class="n">ComboBox</span><span class="o">::</span><span class="n">Listener</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Constructor */</span><span class="w"></span>
<span class="w">      </span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">GenericProcessor</span><span class="o">*</span><span class="w"> </span><span class="n">parentNode</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Destructor */</span><span class="w"></span>
<span class="w">      </span><span class="o">~</span><span class="n">RateViewerEditor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Creates the canvas */</span><span class="w"></span>
<span class="w">      </span><span class="n">Visualizer</span><span class="o">*</span><span class="w"> </span><span class="n">createNewCanvas</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** ComboBox::Listener callback*/</span><span class="w"></span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">comboBoxChanged</span><span class="p">(</span><span class="n">ComboBox</span><span class="o">*</span><span class="w"> </span><span class="n">comboBox</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ComboBox</span><span class="o">&gt;</span><span class="w"> </span><span class="n">electrodeList</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Generates an assertion if this class leaks */</span><span class="w"></span>
<span class="w">           </span><span class="n">JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR</span><span class="p">(</span><span class="n">RateViewerEditor</span><span class="p">);</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Next, in <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor.cpp</span></code>, delete the existing comment from the class constructor and add the following lines:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">electrodeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ComboBox</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Electrode List&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">addListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">setBounds</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="n">addAndMakeVisible</span><span class="p">(</span><span class="n">electrodeList</span><span class="p">.</span><span class="n">get</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<p>This creates the electrode list, sets the <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code> as a listener, specifies its position, and adds it to the editor.</p>
<p>Now, create an empty implementation of the <code class="code docutils literal notranslate"><span class="pre">comboBoxChanged()</span></code> method:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerEditor::comboBoxChanged</span><span class="p">(</span><span class="n">ComboBox</span><span class="o">*</span><span class="w"> </span><span class="n">comboBox</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// Keep it empty for now</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>At this point, you should compile the plugin and launch the GUI. You should see the newly added Combo Box, which will be empty for now.</p>
</section>
<section id="populating-the-combo-box">
<h3>Populating the Combo Box<a class="headerlink" href="#populating-the-combo-box" title="Permalink to this heading">#</a></h3>
<p>To add the available electrodes to the editor, we will have to request the list of the electrodes that’s stored in the processor. We’ll want to do this every time the signal chain is modified or a different stream is selected, so that the electrodes and always up-to-date. The easiest way to do this is to override the editor’s <code class="code docutils literal notranslate"><span class="pre">selectedStreamHasChanged()</span></code> method.</p>
<p>First, lets add a public method to the processor that returns an array of electrode names for the specified stream:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Returns the names of available electrodes */</span><span class="w"></span>
<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">getElectrodesForStream</span><span class="p">(</span><span class="n">uint16</span><span class="w"> </span><span class="n">streamId</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RateViewer</span><span class="o">::</span><span class="n">getElectrodesForStream</span><span class="p">(</span><span class="n">uint16</span><span class="w"> </span><span class="n">streamId</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">electrodesForStream</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">electrodes</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">streamId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">streamId</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">electrodesForStream</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">electrodesForStream</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Now, we can override the <code class="code docutils literal notranslate"><span class="pre">selectedStreamHasChanged()</span></code> method in the editor as follows:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.h</span><a class="headerlink" href="#id10" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Called when selected stream is updated*/</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">selectedStreamHasChanged</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.cpp</span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerEditor::selectedStreamHasChanged</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">RateViewer</span><span class="o">*</span><span class="w"> </span><span class="n">rateViewerNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RateViewer</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">getProcessor</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">selectedStream</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">Electrode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">currentElectrodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rateViewerNode</span><span class="o">-&gt;</span><span class="n">getElectrodesForStream</span><span class="p">(</span><span class="n">selectedStream</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">currentElectrodes</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="n">electrode</span><span class="p">,</span><span class="w"> </span><span class="o">++</span><span class="n">id</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">setSelectedId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sendNotification</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Once the plugin has been re-compiled and loaded into the GUI, if there any spike channels created by an upstream <a class="reference internal" href="../User-Manual/Plugins/Spike-Detector.html#spikedetector"><span class="std std-ref">Spike Detector</span></a> plugin, these will be will be automatically added to the Combo Box:</p>
<img alt="Create a Combo Box" src="../_images/visualizerplugin-03.png" />
</section>
<section id="defining-plugin-parameters">
<h3>Defining plugin parameters<a class="headerlink" href="#defining-plugin-parameters" title="Permalink to this heading">#</a></h3>
<p>To calculate the spike rate of an electrode, we need to define a window of interest and then count the spikes within smaller windows (or bins). We’d like to make it possible for the user to customize the window size as well as the bin size. This can be done by creating an <code class="code docutils literal notranslate"><span class="pre">IntParameter</span></code> for each of these inside the <code class="code docutils literal notranslate"><span class="pre">RateViewer</span></code> constructor, as well as Text Box parameter editors inside the <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor</span></code> constructor:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">RateViewer</span><span class="o">::</span><span class="n">RateViewer</span><span class="p">()</span><span class="w"></span>
<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">GenericProcessor</span><span class="p">(</span><span class="s">&quot;Rate Viewer&quot;</span><span class="p">),</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">addIntParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="o">::</span><span class="n">GLOBAL_SCOPE</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;window_size&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;Size of the window in ms&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Default: 1000, Min: 100, Max: 5000</span>

<span class="w">   </span><span class="n">addIntParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="o">::</span><span class="n">GLOBAL_SCOPE</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;bin_size&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;Size of the bins in ms&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span><span class="w"> </span><span class="c1">// Default: 50, Min: 25, Max: 500</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.cpp</span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">RateViewerEditor</span><span class="o">::</span><span class="n">RateViewerEditor</span><span class="p">(</span><span class="n">GenericProcessor</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">VisualizerEditor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spike Rate&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">210</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">electrodeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ComboBox</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Electrode List&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">addListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">electrodeList</span><span class="o">-&gt;</span><span class="n">setBounds</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">addAndMakeVisible</span><span class="p">(</span><span class="n">electrodeList</span><span class="p">.</span><span class="n">get</span><span class="p">());</span><span class="w"></span>

<span class="w">   </span><span class="n">addTextBoxParameterEditor</span><span class="p">(</span><span class="s">&quot;window_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;--------</span>

<span class="w">   </span><span class="n">addTextBoxParameterEditor</span><span class="p">(</span><span class="s">&quot;bin_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;--------</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be sure the parameter names match exactly between the processor and the editor, otherwise it will lead to a crash!</p>
</div>
<p>Compile and load the plugin into the GUI to see the newly added text boxes.</p>
<img alt="Create Text Boxes" src="../_images/visualizerplugin-04.png" />
</section>
</section>
<section id="responding-to-parameter-value-changes">
<h2>Responding to parameter value changes<a class="headerlink" href="#responding-to-parameter-value-changes" title="Permalink to this heading">#</a></h2>
<p>Now, let’s allow our UI elements to change the state of the plugin. To do this, we will have our plugin override the <code class="code docutils literal notranslate"><span class="pre">parameterValueChanged()</span></code> method, which is called whenever one of the parameters is updated via the editor.</p>
<p>First, let’s add the declaration to <code class="code docutils literal notranslate"><span class="pre">RateViewer.h</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="cm">/** Called whenever a parameter&#39;s value is changed */</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">parameterValueChanged</span><span class="p">(</span><span class="n">Parameter</span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Next, add the function definition inside <code class="code docutils literal notranslate"><span class="pre">RateViewer.cpp</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::parameterValueChanged</span><span class="p">(</span><span class="n">Parameter</span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">().</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;window_size&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">().</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;bin_size&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>For now, this only extracts the new value of each parameter. Later, we will send these values to the Visualizer in order to update our rate plot.</p>
<p>In order to allow the Combo Box to be used to select which electrode to display, we need to go back to the editor and define the <code class="code docutils literal notranslate"><span class="pre">comboBoxChanged()</span></code> method:</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.cpp</span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerEditor::comboBoxChanged</span><span class="p">(</span><span class="n">ComboBox</span><span class="o">*</span><span class="w"> </span><span class="n">comboBox</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">comboBox</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">electrodeList</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">comboBox</span><span class="o">-&gt;</span><span class="n">getNumItems</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RateViewer</span><span class="o">*</span><span class="w"> </span><span class="n">rateViewerNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RateViewer</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">getProcessor</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="n">rateViewerNode</span><span class="o">-&gt;</span><span class="n">setActiveElectrode</span><span class="p">(</span><span class="n">selectedStream</span><span class="p">,</span><span class="w"> </span><span class="n">comboBox</span><span class="o">-&gt;</span><span class="n">getText</span><span class="p">());</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>This calls the <code class="code docutils literal notranslate"><span class="pre">setActiveElectrode()</span></code> method which doesn’t exist yet, so let’s define it in the processor:</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id17" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Changes the electrode that&#39;s used to calculate spike rate */</span><span class="w"></span>
<span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setActiveElectrode</span><span class="p">(</span><span class="n">uint16</span><span class="w"> </span><span class="n">streamId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id18" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::setActiveElectrode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">electrodes</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">streamId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">streamId</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// activate the selected electrode</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">//de-activate all other electrodes</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Our editor UI is now complete!</p>
</section>
<section id="creating-the-visualizer">
<h2>Creating the Visualizer<a class="headerlink" href="#creating-the-visualizer" title="Permalink to this heading">#</a></h2>
<p>Now that out processor and editor have been set up, we can move on to creating the Visualizer by adding code to the <code class="code docutils literal notranslate"><span class="pre">RateViewerCanvas</span></code> class. The Visualizer is going to use the GUI’s built-in <a class="reference external" href="https://open-ephys.github.io/gui-docs/Developer-Guide/Open-Ephys-Plugin-API/Visualizer-Plugins.html#interactive-plots">InteractivePlot</a> class that provides some basic functionality for drawing 2D charts. The X-axis for our plot will be the bin offset from the current time in milliseconds, and the Y-axis is going to be the spike rate in Hz. Lets create the plot as follows:</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id19" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">RateViewerCanvas</span><span class="o">::</span><span class="n">RateViewerCanvas</span><span class="p">(</span><span class="n">RateViewer</span><span class="o">*</span><span class="w"> </span><span class="n">processor_</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="o">:</span><span class="w"> </span><span class="n">processor</span><span class="p">(</span><span class="n">processor_</span><span class="p">),</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// Initialize the plot</span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Offset (ms)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Rate (Hz)&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">setInteractive</span><span class="p">(</span><span class="n">InteractivePlotMode</span><span class="o">::</span><span class="n">OFF</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">setBackgroundColour</span><span class="p">(</span><span class="n">Colours</span><span class="o">::</span><span class="n">darkslategrey</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">addAndMakeVisible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">plt</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">setBounds</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Once compiled and loaded into the GUI, you can open the canvas via the editor and you should be able to see a blank 2D chart inside.</p>
<img alt="Blank Canvas Plot" src="../_images/visualizerplugin-05.png" />
<p>Next, let’s give the processor a pointer to the canvas so it can relay the relevant parameter updates:</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id20" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RateViewerCanvas</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;--- need to declare this class at the top of the file</span>

<span class="cm">/**</span>
<span class="cm">   A plugin that includes a canvas for displaying incoming data</span>
<span class="cm">   or an extended settings interface.</span>
<span class="cm">*/</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateViewer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">GenericProcessor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="p">...</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Pointer to the Visualizer */</span><span class="w"></span>
<span class="w">   </span><span class="n">RateViewerCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">canvas</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id21" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewer.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewerEditor.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RateViewerCanvas.h&quot;</span><span class="c1"> // &lt;--- add a new include</span><span class="cp"></span>
</pre></div>
</div>
</div>
<p>This pointer will get updated by <code class="code docutils literal notranslate"><span class="pre">RateViewerEditor::createNewCanvas()</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">RateViewerEditor.cpp</span><a class="headerlink" href="#id22" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Visualizer</span><span class="o">*</span><span class="w"> </span><span class="nf">RateViewerEditor::createNewCanvas</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">RateViewer</span><span class="o">*</span><span class="w"> </span><span class="n">rateViewerNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RateViewer</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">getProcessor</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">RateViewerCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">rateViewerCanvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RateViewerCanvas</span><span class="p">(</span><span class="n">rateViewerNode</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">rateViewerNode</span><span class="o">-&gt;</span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rateViewerCanvas</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">selectedStreamHasChanged</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rateViewerCanvas</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<section id="updating-canvas-parameters">
<h3>Updating Canvas parameters<a class="headerlink" href="#updating-canvas-parameters" title="Permalink to this heading">#</a></h3>
<p>Now, we can have the processor notify the visualizer whenever parameters have changed, so the visualizer can use these parameters to do the actual spike rate calculation. For that, we need to relay the window size, bin size, and electrode name information to the canvas. We also need to send the sample rate of the currently active electrode to the canvas as we’ll need that to convert the spike sample numbers to times in milliseconds.</p>
<p>First, let’s create the relevant member variables in the <code class="code docutils literal notranslate"><span class="pre">RateViewerCanvas</span></code> class, as well as helper functions to allow the processor to modify their values.</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id23" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="p">...</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Set the window size for spike rate calculation */</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">setWindowSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Set the bin size for spike rate calculation */</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">setBinSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">binSize_</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Set the sample rate for the active electrode */</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">setSampleRate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sampleRate</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Change the plot title*/</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPlotTitle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">title</span><span class="p">);</span><span class="w"></span>

<span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="p">...</span><span class="w"></span>

<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">sampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id24" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setWindowSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setBinSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">binSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binSize_</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setSampleRate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sampleRate_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">sampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleRate_</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setPlotTitle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">String</span><span class="o">&amp;</span><span class="w"> </span><span class="n">title</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Next, we’ll have the processor to call those helper functions every time a parameter changes. Note that before we update any canvas values, we need to make sure the canvas actually exists as there can be cases where the canvas is not created while the plugin is loaded into the GUI resulting into segmentation faults.</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id25" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::parameterValueChanged</span><span class="p">(</span><span class="n">Parameter</span><span class="o">*</span><span class="w"> </span><span class="n">param</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">().</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;window_size&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">setWindowSizeMs</span><span class="p">(</span><span class="n">windowSize</span><span class="p">);</span><span class="w">  </span><span class="c1">// Update window size in canvas</span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">().</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;bin_size&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">param</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">setBinSizeMs</span><span class="p">(</span><span class="n">binSize</span><span class="p">);</span><span class="w"> </span><span class="c1">// update bin size in canvas</span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::setActiveElectrode</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">electrode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">electrodes</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">equalsIgnoreCase</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="c1">// set the canvas&#39;s sample rate to electrode&#39;s sample rate</span>
<span class="w">               </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">setSampleRate</span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">sampleRate</span><span class="p">);</span><span class="w"></span>

<span class="w">               </span><span class="c1">// set the canvas&#39;s plot tile to selected electrode&#39;s name</span>
<span class="w">               </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">setPlotTitle</span><span class="p">(</span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">electrode</span><span class="o">-&gt;</span><span class="n">isActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="pushing-spikes-to-the-canvas">
<h3>Pushing spikes to the canvas<a class="headerlink" href="#pushing-spikes-to-the-canvas" title="Permalink to this heading">#</a></h3>
<p>Now that all the parameters have been created, we can start pushing information about each incoming spike received by the processor. First, let’s create a function for sending sample numbers to the canvas, and an array to store them.</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id26" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Adds a spike sample number */</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">addSpike</span><span class="p">(</span><span class="n">int64</span><span class="w"> </span><span class="n">sample_number</span><span class="p">);</span><span class="w"></span>

<span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">int64</span><span class="o">&gt;</span><span class="w"> </span><span class="n">incomingSpikeSampleNums</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id27" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::addSpike</span><span class="p">(</span><span class="n">int64</span><span class="w"> </span><span class="n">sample_num</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">incomingSpikeSampleNums</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">sample_num</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Next, we can push spikes to the visualizer inside the processor’s <code class="code docutils literal notranslate"><span class="pre">void</span> <span class="pre">handleSpike()</span></code> method, which is called for every incoming spike. Inside this method we will get the spike sample number and pass it on to the canvas. Note that this function is automatically called because <code class="code docutils literal notranslate"><span class="pre">checkForEvents(true);</span></code> has been added to the <code class="code docutils literal notranslate"><span class="pre">process()</span></code> method.</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id28" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::handleSpike</span><span class="p">(</span><span class="n">SpikePtr</span><span class="w"> </span><span class="n">spike</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">spike</span><span class="o">-&gt;</span><span class="n">getStreamId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">getEditor</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getCurrentStream</span><span class="p">()</span><span class="w"> </span><span class="c1">// spike stream matches the current stream</span>
<span class="w">      </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">electrodeMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">spike</span><span class="o">-&gt;</span><span class="n">getChannelInfo</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">isActive</span><span class="w"> </span><span class="c1">// electrode is active</span>
<span class="w">      </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// canvas exists</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">addSpike</span><span class="p">(</span><span class="n">spike</span><span class="o">-&gt;</span><span class="n">getSampleNumber</span><span class="p">());</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Since the <code class="code docutils literal notranslate"><span class="pre">process()</span></code> method brings in data in blocks (buffers), we need a way to ensure the display only shows spikes that fall within the window defined by the user. This can be done by passing the most recent sample number for the current buffer to the canvas within every process loop. Update the <code class="code docutils literal notranslate"><span class="pre">process()</span></code> method as follows:</p>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text">RateViewer.cpp</span><a class="headerlink" href="#id29" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewer::process</span><span class="p">(</span><span class="n">AudioBuffer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">buffer</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">checkForEvents</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">getDataStreams</span><span class="p">())</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">stream</span><span class="o">-&gt;</span><span class="n">getStreamId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">getEditor</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getCurrentStream</span><span class="p">())</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">int64</span><span class="w"> </span><span class="n">mostRecentSample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getFirstSampleNumberForBlock</span><span class="p">(</span><span class="n">stream</span><span class="o">-&gt;</span><span class="n">getStreamId</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNumSamplesInBlock</span><span class="p">(</span><span class="n">stream</span><span class="o">-&gt;</span><span class="n">getStreamId</span><span class="p">());</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">canvas</span><span class="o">-&gt;</span><span class="n">setMostRecentSample</span><span class="p">(</span><span class="n">mostRecentSample</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Since the <code class="code docutils literal notranslate"><span class="pre">setMostRecentSample</span></code> function doesn’t exist yet, we need to create it inside <code class="code docutils literal notranslate"><span class="pre">RateViewerCanvas</span></code> class:</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id30" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Sets the sample index for the latest buffer*/</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">setMostRecentSample</span><span class="p">(</span><span class="n">int64</span><span class="w"> </span><span class="n">sampleNum</span><span class="p">);</span><span class="w"></span>

<span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="n">int64</span><span class="w"> </span><span class="n">mostRecentSample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id31" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setMostRecentSample</span><span class="p">(</span><span class="n">int64</span><span class="w"> </span><span class="n">sampleNum</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">mostRecentSample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleNum</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</section>
<section id="calculating-the-spike-rate">
<h3>Calculating the spike rate<a class="headerlink" href="#calculating-the-spike-rate" title="Permalink to this heading">#</a></h3>
<p>Now, we have all the required information for calculating the spike rate. To do the calculation, we first need to calculate the bin edges. The bin edges will allow us to group the incoming spike sample numbers to specific bins, relative to the most recent sample number. We also need to make sure bin edges are updated every time the bin size changes or whenever the active electrode changes. Let’s implement the bin edge calculation inside a function called <code class="code docutils literal notranslate"><span class="pre">recomputeBinEdges()</span></code>, which will be called every time we need to update the bin edges:</p>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id32" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Recomputes bin edges */</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">binEdges</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">spikeCounts</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id33" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::recomputeBinEdges</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">binEdges</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">spikeCounts</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">binSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">windowSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">binEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="n">windowSize</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">binEdge</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">binEdges</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">binEdge</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">binEdge</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">binSize</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="n">binEdges</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">spikeCounts</span><span class="p">.</span><span class="n">insertMultiple</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">binEdges</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setWindowSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;-------- add function call here</span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setBinSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">binSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binSize_</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;-------- add function call here</span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setSampleRate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">sampleRate_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">sampleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleRate_</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;-------- add function call here</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Now we can count the spikes in each bin:</p>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id34" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Recounts spikes/bin; returns true if a new bin is available */</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">countSpikes</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">int64</span><span class="w"> </span><span class="n">sampleOnLastRedraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">maxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id35" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">RateViewerCanvas::countSpikes</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">elapsedSamples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mostRecentSample</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sampleOnLastRedraw</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">elapsedTimeMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="n">elapsedSamples</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sampleRate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000.0f</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// Only count spikes when the time since the last count is greater than the bin size</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">elapsedTimeMs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">binSize</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">counts</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// remove oldest count</span>

<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">newSpikeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incomingSpikeSampleNums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">newSpikeCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxCount</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">maxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newSpikeCount</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">counts</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">newSpikeCount</span><span class="p">);</span><span class="w"> </span><span class="c1">// add most recent count</span>

<span class="w">   </span><span class="n">incomingSpikeSampleNums</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">sampleOnLastRedraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mostRecentSample</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Note that we are using the <code class="code docutils literal notranslate"><span class="pre">maxCount</span></code> value to keep track of the maximum number of spikes counted in a bin, which will then be used to se the plot range. We need to update the plot range whenever the window size is updated or the <code class="code docutils literal notranslate"><span class="pre">maxCount</span></code> value is updated:</p>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.h</span><a class="headerlink" href="#id36" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Change the XY range of the spike rate plot */</span><span class="w"></span>
<span class="w">   </span><span class="kt">void</span><span class="w"> </span><span class="n">updatePlotRange</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id37" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::updatePlotRange</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">XYRange</span><span class="w"> </span><span class="n">range</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">range</span><span class="p">.</span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">-</span><span class="n">windowSize</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">range</span><span class="p">.</span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">range</span><span class="p">.</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">range</span><span class="p">.</span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">maxCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">binSize</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">plt</span><span class="p">.</span><span class="n">setRange</span><span class="p">(</span><span class="n">range</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setWindowSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">windowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">windowSize_</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">updatePlotRange</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;--------</span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::setBinSizeMs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">binSize_</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">binSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binSize_</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">recomputeBinEdges</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">maxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;--------</span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::countSpikes</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">...</span><span class="w"></span>

<span class="w">   </span><span class="n">incomingSpikeSampleNums</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">updatePlotRange</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;--------</span>

<span class="w">   </span><span class="n">sampleOnLastRedraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mostRecentSample</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Lastly, we need to do the actual plotting. We need to make sure the spikes are counted and plot is updated at regular intervals. To do that, we will use the canvas’ <code class="code docutils literal notranslate"><span class="pre">refresh()</span></code> method which is called at regular intervals. This allows us to recount the incoming spikes and animate the plot. First, lets implement the <code class="code docutils literal notranslate"><span class="pre">refresh()</span></code> method, where we will use the center of the bins in milliseconds as X values and spike rate in Hz as Y-values:</p>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">RateViewerCanvas.cpp</span><a class="headerlink" href="#id38" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RateViewerCanvas::refresh</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">countSpikes</span><span class="p">())</span><span class="w"> </span><span class="c1">// returns true if a new bin is available</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">binEdges</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">binEdges</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">         </span><span class="n">y</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">spikeCounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">binSize</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="n">plt</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">Colours</span><span class="o">::</span><span class="n">lightyellow</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="n">PlotType</span><span class="o">::</span><span class="n">FILLED</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Then, update the processor class to notify the editor to begin animation on the canvas as soon as acquisition starts and stop animation as soon as acquisition stops.</p>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id39" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Enables the editor */</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">startAcquisition</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="cm">/** Disables the editor*/</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="nf">stopAcquisition</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">RateViewer.h</span><a class="headerlink" href="#id40" title="Permalink to this code">#</a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">RateViewer::startAcquisition</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">((</span><span class="n">RateViewerEditor</span><span class="o">*</span><span class="p">)</span><span class="n">getEditor</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">RateViewer::stopAcquisition</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">((</span><span class="n">RateViewerEditor</span><span class="o">*</span><span class="p">)</span><span class="n">getEditor</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">disable</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>And that’s it! If you compile and test your plugin, the canvas should start plotting the spike rate of the selected electrode. Modifications to the window size or bin size parameters should be immediately reflected in the plot.</p>
<img alt="Plugin with spike rate plot visualized" src="../_images/visualizerplugin-06.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="How-To-Make-Your-Own-Plugin.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">How To Make Your Own Plugin</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../FAQ/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">FAQs</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-a-new-plugin-repository">
   Creating a new plugin repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#editing-openephyslib-cpp-and-other-files">
   Editing
   <code class="code docutils literal notranslate">
    <span class="pre">
     OpenEphysLib.cpp
    </span>
   </code>
   and other files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compiling-your-plugin">
   Compiling your plugin
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-processor-methods">
   Setting up the Processor methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-ui-components-to-the-editor">
   Adding UI components to the editor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-combo-box">
     Creating a Combo Box
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#populating-the-combo-box">
     Populating the Combo Box
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-plugin-parameters">
     Defining plugin parameters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#responding-to-parameter-value-changes">
   Responding to parameter value changes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-the-visualizer">
   Creating the Visualizer
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updating-canvas-parameters">
     Updating Canvas parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pushing-spikes-to-the-canvas">
     Pushing spikes to the canvas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-the-spike-rate">
     Calculating the spike rate
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2010-2022, Open Ephys &amp; Contributors.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>